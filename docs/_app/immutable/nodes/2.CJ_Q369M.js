import{s as Y,n as Z,r as ke,b as Ce,o as we,e as Fe}from"../chunks/scheduler.BvLojk_z.js";import{S as G,i as Q,e as b,b as q,s as A,c as k,d as I,f as K,h as B,g as h,p as P,j as C,k as F,l as L,t as D,w as he,u as ge,a as T,o as Pe,y as U,z,v as M,A as J,B as O,q as $,n as x,r as ee,m as W}from"../chunks/index.B6IjQEsh.js";import{w as Ie}from"../chunks/index.BGTSHx9J.js";import{e as te,t as Ee,i as Se}from"../chunks/index.BS81UHqu.js";function ne(i){let e,t;return{c(){e=b("rt"),t=q(i[1])},l(l){e=k(l,"RT",{});var n=I(e);t=K(n,i[1]),n.forEach(h)},m(l,n){C(l,e,n),F(e,t)},p(l,n){n&2&&L(t,l[1])},d(l){l&&h(e)}}}function Re(i){let e,t,l,n=i[1]&&ne(i);return{c(){e=b("ruby"),t=q(i[0]),l=A(),n&&n.c(),this.h()},l(s){e=k(s,"RUBY",{class:!0});var r=I(e);t=K(r,i[0]),l=B(r),n&&n.l(r),r.forEach(h),this.h()},h(){P(e,"class","svelte-idbqik")},m(s,r){C(s,e,r),F(e,t),F(e,l),n&&n.m(e,null)},p(s,[r]){r&1&&L(t,s[0]),s[1]?n?n.p(s,r):(n=ne(s),n.c(),n.m(e,null)):n&&(n.d(1),n=null)},i:Z,o:Z,d(s){s&&h(e),n&&n.d()}}}function ye(i,e,t){let{reading:l}=e,{furigana:n=null}=e;return i.$$set=s=>{"reading"in s&&t(0,l=s.reading),"furigana"in s&&t(1,n=s.furigana)},[l,n]}class De extends G{constructor(e){super(),Q(this,e,ye,Re,Y,{reading:0,furigana:1})}}function re(i,e,t){const l=i.slice();return l[3]=e[t],l[5]=t,l}function le(i){let e,t,l,n;return e=new De({props:{reading:i[3],furigana:i[1][i[5]]}}),{c(){t=b("div"),U(e.$$.fragment),this.h()},l(s){t=k(s,"DIV",{style:!0});var r=I(t);z(e.$$.fragment,r),this.h()},h(){M(t,"display","contents"),M(t,"--reading-color",l=i[2][i[5]])},m(s,r){C(s,t,r),J(e,t,null),n=!0},p(s,r){r&4&&l!==(l=s[2][s[5]])&&M(t,"--reading-color",l);const a={};r&1&&(a.reading=s[3]),r&2&&(a.furigana=s[1][s[5]]),e.$set(a)},i(s){n||(D(e.$$.fragment,s),n=!0)},o(s){T(e.$$.fragment,s),n=!1},d(s){s&&e&&h(t),O(e,s)}}}function Ve(i){let e,t,l=te(i[0]),n=[];for(let r=0;r<l.length;r+=1)n[r]=le(re(i,l,r));const s=r=>T(n[r],1,1,()=>{n[r]=null});return{c(){e=b("div");for(let r=0;r<n.length;r+=1)n[r].c()},l(r){e=k(r,"DIV",{});var a=I(e);for(let u=0;u<n.length;u+=1)n[u].l(a);a.forEach(h)},m(r,a){C(r,e,a);for(let u=0;u<n.length;u+=1)n[u]&&n[u].m(e,null);t=!0},p(r,[a]){if(a&7){l=te(r[0]);let u;for(u=0;u<l.length;u+=1){const d=re(r,l,u);n[u]?(n[u].p(d,a),D(n[u],1)):(n[u]=le(d),n[u].c(),D(n[u],1),n[u].m(e,null))}for(he(),u=l.length;u<n.length;u+=1)s(u);ge()}},i(r){if(!t){for(let a=0;a<l.length;a+=1)D(n[a]);t=!0}},o(r){n=n.filter(Boolean);for(let a=0;a<n.length;a+=1)T(n[a]);t=!1},d(r){r&&h(e),Pe(n,r)}}}function Ae(i,e,t){let{readings:l=[]}=e,{furigana:n=[]}=e,{colors:s=[]}=e;return i.$$set=r=>{"readings"in r&&t(0,l=r.readings),"furigana"in r&&t(1,n=r.furigana),"colors"in r&&t(2,s=r.colors)},[l,n,s]}class se extends G{constructor(e){super(),Q(this,e,Ae,Ve,Y,{readings:0,furigana:1,colors:2})}}function ae(i){let e,t=i[0].translation+"",l,n,s,r=i[0].hint&&ie(i);return{c(){e=b("h1"),l=q(t),n=A(),r&&r.c(),s=ee(),this.h()},l(a){e=k(a,"H1",{class:!0});var u=I(e);l=K(u,t),u.forEach(h),n=B(a),r&&r.l(a),s=ee(),this.h()},h(){P(e,"class","svelte-1rb25bv")},m(a,u){C(a,e,u),F(e,l),C(a,n,u),r&&r.m(a,u),C(a,s,u)},p(a,u){u&1&&t!==(t=a[0].translation+"")&&L(l,t),a[0].hint?r?r.p(a,u):(r=ie(a),r.c(),r.m(s.parentNode,s)):r&&(r.d(1),r=null)},d(a){a&&(h(e),h(n),h(s)),r&&r.d(a)}}}function ie(i){let e,t,l=i[0].hint+"",n;return{c(){e=b("div"),t=b("p"),n=q(l),this.h()},l(s){e=k(s,"DIV",{class:!0});var r=I(e);t=k(r,"P",{});var a=I(t);n=K(a,l),a.forEach(h),r.forEach(h),this.h()},h(){P(e,"class","hint-container svelte-1rb25bv")},m(s,r){C(s,e,r),F(e,t),F(t,n)},p(s,r){r&1&&l!==(l=s[0].hint+"")&&L(n,l)},d(s){s&&h(e)}}}function oe(i){let e,t="Loading...";return{c(){e=b("h1"),e.textContent=t,this.h()},l(l){e=k(l,"H1",{class:!0,"data-svelte-h":!0}),W(e)!=="svelte-1rkekmq"&&(e.textContent=t),this.h()},h(){P(e,"class","svelte-1rb25bv")},m(l,n){C(l,e,n)},d(l){l&&h(e)}}}function ue(i){let e,t,l,n,s,r,a,u;t=new se({props:{readings:i[2].expectedReading,furigana:[],colors:i[2].readingCorrectness.map(ce)}}),n=new se({props:{readings:i[0].reading,furigana:i[0].furigana,colors:i[2].sentencePartsCorrectness.map(de)}});let d=i[0].note&&fe(i);function E(o,c){return o[4]?Te:Be}let S=E(i),g=S(i);return{c(){e=b("div"),U(t.$$.fragment),l=A(),U(n.$$.fragment),s=A(),d&&d.c(),r=A(),a=b("div"),g.c(),this.h()},l(o){e=k(o,"DIV",{class:!0});var c=I(e);z(t.$$.fragment,c),l=B(c),z(n.$$.fragment,c),c.forEach(h),s=B(o),d&&d.l(o),r=B(o),a=k(o,"DIV",{class:!0});var _=I(a);g.l(_),_.forEach(h),this.h()},h(){P(e,"class","sentence-container svelte-1rb25bv"),P(a,"class","result-container svelte-1rb25bv")},m(o,c){C(o,e,c),J(t,e,null),F(e,l),J(n,e,null),C(o,s,c),d&&d.m(o,c),C(o,r,c),C(o,a,c),g.m(a,null),u=!0},p(o,c){const _={};c&4&&(_.readings=o[2].expectedReading),c&4&&(_.colors=o[2].readingCorrectness.map(ce)),t.$set(_);const w={};c&1&&(w.readings=o[0].reading),c&1&&(w.furigana=o[0].furigana),c&4&&(w.colors=o[2].sentencePartsCorrectness.map(de)),n.$set(w),o[0].note?d?d.p(o,c):(d=fe(o),d.c(),d.m(r.parentNode,r)):d&&(d.d(1),d=null),S!==(S=E(o))&&(g.d(1),g=S(o),g&&(g.c(),g.m(a,null)))},i(o){u||(D(t.$$.fragment,o),D(n.$$.fragment,o),u=!0)},o(o){T(t.$$.fragment,o),T(n.$$.fragment,o),u=!1},d(o){o&&(h(e),h(s),h(r),h(a)),O(t),O(n),d&&d.d(o),g.d()}}}function fe(i){let e,t,l=i[0].note+"",n;return{c(){e=b("div"),t=b("p"),n=q(l),this.h()},l(s){e=k(s,"DIV",{class:!0});var r=I(e);t=k(r,"P",{});var a=I(t);n=K(a,l),a.forEach(h),r.forEach(h),this.h()},h(){P(e,"class","note-container svelte-1rb25bv")},m(s,r){C(s,e,r),F(e,t),F(t,n)},p(s,r){r&1&&l!==(l=s[0].note+"")&&L(n,l)},d(s){s&&h(e)}}}function Be(i){let e,t="Incorrect";return{c(){e=b("h2"),e.textContent=t,this.h()},l(l){e=k(l,"H2",{class:!0,"data-svelte-h":!0}),W(e)!=="svelte-vqooav"&&(e.textContent=t),this.h()},h(){P(e,"class","incorrect svelte-1rb25bv")},m(l,n){C(l,e,n)},d(l){l&&h(e)}}}function Te(i){let e,t="Correct!";return{c(){e=b("h2"),e.textContent=t,this.h()},l(l){e=k(l,"H2",{class:!0,"data-svelte-h":!0}),W(e)!=="svelte-vwb2ui"&&(e.textContent=t),this.h()},h(){P(e,"class","correct svelte-1rb25bv")},m(l,n){C(l,e,n)},d(l){l&&h(e)}}}function je(i){let e,t,l,n,s,r,a,u,d,E,S,g=i[0]!==null&&ae(i),o=i[0]===null&&oe(),c=i[2]!==null&&i[3]&&ue(i);return{c(){e=b("div"),t=b("div"),g&&g.c(),l=A(),o&&o.c(),n=A(),s=b("div"),r=b("div"),a=b("input"),u=A(),c&&c.c(),this.h()},l(_){e=k(_,"DIV",{class:!0});var w=I(e);t=k(w,"DIV",{class:!0});var V=I(t);g&&g.l(V),l=B(V),o&&o.l(V),n=B(V),s=k(V,"DIV",{class:!0});var j=I(s);r=k(j,"DIV",{class:!0});var N=I(r);a=k(N,"INPUT",{type:!0,class:!0}),N.forEach(h),u=B(j),c&&c.l(j),j.forEach(h),V.forEach(h),w.forEach(h),this.h()},h(){P(a,"type","text"),P(a,"class","svelte-1rb25bv"),P(r,"class","input-container svelte-1rb25bv"),P(s,"class","content"),P(t,"class","container svelte-1rb25bv"),P(e,"class","page")},m(_,w){C(_,e,w),F(e,t),g&&g.m(t,null),F(t,l),o&&o.m(t,null),F(t,n),F(t,s),F(s,r),F(r,a),$(a,i[1]),i[9](a),F(s,u),c&&c.m(s,null),d=!0,E||(S=[x(a,"input",i[8]),x(a,"input",i[7])],E=!0)},p(_,[w]){_[0]!==null?g?g.p(_,w):(g=ae(_),g.c(),g.m(t,l)):g&&(g.d(1),g=null),_[0]===null?o||(o=oe(),o.c(),o.m(t,n)):o&&(o.d(1),o=null),w&2&&a.value!==_[1]&&$(a,_[1]),_[2]!==null&&_[3]?c?(c.p(_,w),w&12&&D(c,1)):(c=ue(_),c.c(),D(c,1),c.m(s,null)):c&&(he(),T(c,1,1,()=>{c=null}),ge())},i(_){d||(D(c),d=!0)},o(_){T(c),d=!1},d(_){_&&h(e),g&&g.d(),o&&o.d(),i[9](null),c&&c.d(),E=!1,ke(S)}}}const ce=i=>i?"#94f77e":"#f25f44",de=i=>i?"#94f77e":"#f25f44";function qe(i,e,t){let l;const n=f=>Ee(f,{IMEMode:!0}),s=f=>f.replace(/[\s.,\/#!$%\^&\*;:{}=\-_`~\u3000-\u303f]/g,""),r=f=>{const p=f.reading.map((v,m)=>Se(v)?v.split("").map(R=>({reading:R,furigana:""})):[{reading:v,furigana:f.furigana[m]}]);return{raw:f.raw,reading:p.flat().map(v=>v.reading),furigana:p.flat().map(v=>v.furigana),translation:f.translation,note:f.note,hint:f.hint}},a=Ie([]);Ce(i,a,f=>t(11,l=f));let u=null,d="",E=null,S=!1,g=!1,o,c=0;const _=f=>{let p="",v=[];for(let m=0;m<f.reading.length;m++){let y=f.reading[m].length;f.furigana[m]!==""?(p+=f.furigana[m],y=f.furigana[m].length):(p+=f.reading[m],y=f.reading[m].length);for(let R=0;R<y;R++)v.push(m)}return{unrolled:p,correspondingSentenceParts:v}},w=f=>{let p="",v=[];for(let m=0;m<f.reading.length;m++){let y=f.reading[m].length;p+=f.reading[m];for(let R=0;R<y;R++)v.push(m)}return{unrolled:p,correspondingSentenceParts:v}},V=f=>f.match(/[\u4E00-\u9FAF]/),j=()=>{if(t(1,d=n(s(d))),u!==null){const f=V(d)?w(u):_(u),p={expectedReading:f.unrolled,readingCorrectness:[],correspondingSentenceParts:f.correspondingSentenceParts,sentencePartsCorrectness:u.reading.map(()=>!1)};for(let v=0;v<d.length;v++){p.readingCorrectness.push(d[v]===f.unrolled[v]);const m=f.correspondingSentenceParts[v],y=f.correspondingSentenceParts.map(R=>R===m?1:0);for(let R=0;R<y.length;R++){const be=y.map((H,X)=>H==0||d[X]===f.unrolled[X]);p.sentencePartsCorrectness[m]=be.every(H=>H)}}d.length>f.unrolled.length&&(p.expectedReading+=d.slice(f.unrolled.length),p.readingCorrectness=p.readingCorrectness.concat(new Array(d.length-f.unrolled.length).fill(!1))),t(2,E=p)}},N=()=>{E!==null&&(t(4,g=E.sentencePartsCorrectness.every(f=>f)&&E.readingCorrectness.every(f=>f)),t(3,S=!0))},_e=()=>{t(2,E=null),t(3,S=!1),t(4,g=!1),t(1,d="")},pe=()=>{c=(c+1)%l.length,t(0,u=r(l[c])),_e(),o.focus()};we(()=>{const f=localStorage.getItem("sentences");f?a.set(JSON.parse(f)):a.set([{raw:"私（わたし）は学生（がくせい）です",reading:["私","は","学生","です"],furigana:["わたし","","がくせい",""],translation:"I am a student",note:"This is a note",hint:"This is a hint"}]),a.subscribe(p=>{p.length>0&&t(0,u=r(p[c]))}),window.addEventListener("keydown",p=>{p.key==="Enter"&&(S?pe():N())}),o.focus()});function me(){d=this.value,t(1,d)}function ve(f){Fe[f?"unshift":"push"](()=>{o=f,t(5,o)})}return[u,d,E,S,g,o,a,j,me,ve]}class Me extends G{constructor(e){super(),Q(this,e,qe,je,Y,{})}}export{Me as component};
