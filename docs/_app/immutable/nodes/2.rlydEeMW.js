import{s as ie,z as j,k as g,i as m,S as de,w as oe,e as C,t as T,b as V,d as b,f as E,h as H,j as N,q as D,l as A,m as O,T as B,C as ae,p as J,J as _e,U as W,r as Z,v as he,y as pe,x as G,V as me,W as ve}from"../chunks/scheduler.CDGtiUFo.js";import{S as ce,i as fe,t as y,g as P,a as S,c as R,b as q,d as z,m as F,e as K,f as ge}from"../chunks/index.B5cZ8GrW.js";import{b as ke,e as Q}from"../chunks/index.Dh9Un3aJ.js";import{h as we,p as Ce,C as X,a as be}from"../chunks/Srs.BX5E71Bv.js";const De=(i,e)=>{const s=we(e);if(e==="")return{readingCorrectness:Array.from({length:i.reading.length},()=>!1),answerCorrectness:Array.from({length:e.length},()=>!1),isCorrect:!1};const l=Ie(s,i),r=e.split("").map((p,h)=>p===l.expectedAnswer[h]),n=l.expectedAnswer.map((p,h)=>p===e[h]),t=Array.from({length:i.reading.length},()=>!0);l.readingMapping.map((p,h)=>{n[h]||(t[p]=!1)});const f=r.every(p=>p),_=t.every(p=>p),v=e.length===l.expectedAnswer.length;return{readingCorrectness:t,answerCorrectness:r,isCorrect:f&&_&&v}},Ie=(i,e)=>{const s=[],l=[];for(let r=0;r<e.reading.length;r++){const n=e.furigana[r],t=e.reading[r];i?(s.push(t),l.push(r)):(n===""?t:n).split("").forEach((_,v)=>{s.push(_),l.push(r)})}return{expectedAnswer:s,readingMapping:l}};function Y(i){let e,s=i[2].translation+"",l,r,n,t,f,_,v,p,h=i[4]&&$(i),u=i[3]&&x(i);return{c(){e=C("h1"),l=T(s),r=V(),n=C("div"),t=C("input"),f=V(),h&&h.c(),_=V(),u&&u.c(),v=j(),this.h()},l(o){e=b(o,"H1",{class:!0});var a=E(e);l=H(a,s),a.forEach(m),r=N(o),n=b(o,"DIV",{class:!0});var c=E(n);t=b(c,"INPUT",{type:!0,class:!0}),c.forEach(m),f=N(o),h&&h.l(o),_=N(o),u&&u.l(o),v=j(),this.h()},h(){D(e,"class","svelte-1y81ww4"),D(t,"type","text"),D(t,"class","svelte-1y81ww4"),D(n,"class","input-container svelte-1y81ww4")},m(o,a){g(o,e,a),A(e,l),g(o,r,a),g(o,n,a),A(n,t),i[10](t),g(o,f,a),h&&h.m(o,a),g(o,_,a),u&&u.m(o,a),g(o,v,a),p=!0},p(o,a){(!p||a&4)&&s!==(s=o[2].translation+"")&&O(l,s),o[4]?h?h.p(o,a):(h=$(o),h.c(),h.m(_.parentNode,_)):h&&(h.d(1),h=null),o[3]?u?(u.p(o,a),a&8&&y(u,1)):(u=x(o),u.c(),y(u,1),u.m(v.parentNode,v)):u&&(P(),S(u,1,1,()=>{u=null}),R())},i(o){p||(y(u),p=!0)},o(o){S(u),p=!1},d(o){o&&(m(e),m(r),m(n),m(f),m(_),m(v)),i[10](null),h&&h.d(o),u&&u.d(o)}}}function $(i){let e,s;return{c(){e=C("div"),s=T(i[4]),this.h()},l(l){e=b(l,"DIV",{class:!0});var r=E(e);s=H(r,i[4]),r.forEach(m),this.h()},h(){D(e,"class","notification svelte-1y81ww4")},m(l,r){g(l,e,r),A(e,s)},p(l,r){r&16&&O(s,l[4])},d(l){l&&m(e)}}}function x(i){let e,s,l,r,n,t,f,_,v,p=i[5]?"Correct!":"Incorrect",h,u,o;s=new X({props:{readings:i[1],furigana:[],colors:i[7]}}),n=new X({props:{readings:i[2].reading,furigana:i[2].furigana,colors:i[6]}});let a=i[2].note&&ee(i);return{c(){e=C("div"),q(s.$$.fragment),l=V(),r=C("div"),q(n.$$.fragment),t=V(),a&&a.c(),f=V(),_=C("div"),v=C("h2"),h=T(p),this.h()},l(c){e=b(c,"DIV",{class:!0});var d=E(e);z(s.$$.fragment,d),d.forEach(m),l=N(c),r=b(c,"DIV",{class:!0});var k=E(r);z(n.$$.fragment,k),k.forEach(m),t=N(c),a&&a.l(c),f=N(c),_=b(c,"DIV",{class:!0});var I=E(_);v=b(I,"H2",{class:!0});var M=E(v);h=H(M,p),M.forEach(m),I.forEach(m),this.h()},h(){D(e,"class","sentence-container svelte-1y81ww4"),D(r,"class","sentence-container svelte-1y81ww4"),D(v,"class",u=B(i[5]?"correct":"incorrect")+" svelte-1y81ww4"),D(_,"class","result-container svelte-1y81ww4")},m(c,d){g(c,e,d),F(s,e,null),g(c,l,d),g(c,r,d),F(n,r,null),g(c,t,d),a&&a.m(c,d),g(c,f,d),g(c,_,d),A(_,v),A(v,h),o=!0},p(c,d){const k={};d&2&&(k.readings=c[1]),d&128&&(k.colors=c[7]),s.$set(k);const I={};d&4&&(I.readings=c[2].reading),d&4&&(I.furigana=c[2].furigana),d&64&&(I.colors=c[6]),n.$set(I),c[2].note?a?a.p(c,d):(a=ee(c),a.c(),a.m(f.parentNode,f)):a&&(a.d(1),a=null),(!o||d&32)&&p!==(p=c[5]?"Correct!":"Incorrect")&&O(h,p),(!o||d&32&&u!==(u=B(c[5]?"correct":"incorrect")+" svelte-1y81ww4"))&&D(v,"class",u)},i(c){o||(y(s.$$.fragment,c),y(n.$$.fragment,c),o=!0)},o(c){S(s.$$.fragment,c),S(n.$$.fragment,c),o=!1},d(c){c&&(m(e),m(l),m(r),m(t),m(f),m(_)),K(s),K(n),a&&a.d(c)}}}function ee(i){let e,s,l=i[2].note+"",r;return{c(){e=C("div"),s=C("p"),r=T(l),this.h()},l(n){e=b(n,"DIV",{class:!0});var t=E(e);s=b(t,"P",{});var f=E(s);r=H(f,l),f.forEach(m),t.forEach(m),this.h()},h(){D(e,"class","note-container svelte-1y81ww4")},m(n,t){g(n,e,t),A(e,s),A(s,r)},p(n,t){t&4&&l!==(l=n[2].note+"")&&O(r,l)},d(n){n&&m(e)}}}function ye(i){let e,s,l=i[2]&&Y(i);return{c(){l&&l.c(),e=j()},l(r){l&&l.l(r),e=j()},m(r,n){l&&l.m(r,n),g(r,e,n),s=!0},p(r,[n]){r[2]?l?(l.p(r,n),n&4&&y(l,1)):(l=Y(r),l.c(),y(l,1),l.m(e.parentNode,e)):l&&(P(),S(l,1,1,()=>{l=null}),R())},i(r){s||(y(l),s=!0)},o(r){S(l),s=!1},d(r){r&&m(e),l&&l.d(r)}}}function Ee(i,e,s){let l,r,n,t,f,{selectedDeck:_=null}=e;const v=de();let p,h="",u=!1,o=!1,a="";const c=()=>{l.length>0&&s(2,L=l[Math.floor(Math.random()*l.length)]),I()},d=()=>{s(1,h=""),s(0,p.value="",p),s(3,u=!1)},k=()=>{s(3,u=!0);const w=L==null?void 0:L.srs;if(w){const U=be(w,f);v("srs",{sentence:L,srs:U})}},I=()=>{p&&p.focus()},M=w=>{o=/[a-zA-Z0-9]/.test(w),console.log("invalidInput",o),console.log("input",w),s(4,a=o?"Invalid characters in input!":"")};let L=null;oe(()=>{c(),window.addEventListener("keydown",w=>{if(w.key==="Enter"){if(M(h),o)return;_&&L&&u?(d(),c()):k()}})});function ue(w){ae[w?"unshift":"push"](()=>{p=w,s(0,p)})}return i.$$set=w=>{"selectedDeck"in w&&s(8,_=w.selectedDeck)},i.$$.update=()=>{i.$$.dirty&256&&(l=_?Ce(_):[]),i.$$.dirty&1&&p&&(s(0,p.value="",p),p&&ke(p),p.addEventListener("input",w=>{s(1,h=w.target.value)}),I()),i.$$.dirty&6&&s(9,r=L&&De(L,h)),i.$$.dirty&512&&s(7,n=r&&r.answerCorrectness.map(w=>w?"#94f77e":"#f25f44")),i.$$.dirty&512&&s(6,t=r&&r.readingCorrectness.map(w=>w?"#94f77e":"#f25f44")),i.$$.dirty&512&&s(5,f=r?r.isCorrect:!1)},[p,h,L,u,a,f,t,n,_,r,ue]}class Ae extends ce{constructor(e){super(),fe(this,e,Ee,ye,ie,{selectedDeck:8})}}function te(i,e,s){const l=i.slice();return l[10]=e[s],l[12]=s,l}function se(i){let e,s="No Decks",l,r,n='Create a deck by going to <a href="/decks">/deck</a>';return{c(){e=C("h1"),e.textContent=s,l=V(),r=C("p"),r.innerHTML=n,this.h()},l(t){e=b(t,"H1",{class:!0,"data-svelte-h":!0}),J(e)!=="svelte-1rj1guh"&&(e.textContent=s),l=N(t),r=b(t,"P",{"data-svelte-h":!0}),J(r)!=="svelte-1nvutjw"&&(r.innerHTML=n),this.h()},h(){D(e,"class","svelte-1m9hyv3")},m(t,f){g(t,e,f),g(t,l,f),g(t,r,f)},d(t){t&&(m(e),m(l),m(r))}}}function le(i){let e,s,l="Choose a deck:",r,n,t,f,_,v,p,h=Q(i[0]),u=[];for(let a=0;a<h.length;a+=1)u[a]=ne(te(i,h,a));let o=i[2]&&re(i);return{c(){e=C("form"),s=C("label"),s.textContent=l,r=V(),n=C("select");for(let a=0;a<u.length;a+=1)u[a].c();t=V(),o&&o.c(),f=j(),this.h()},l(a){e=b(a,"FORM",{});var c=E(e);s=b(c,"LABEL",{for:!0,"data-svelte-h":!0}),J(s)!=="svelte-smnxxd"&&(s.textContent=l),r=N(c),n=b(c,"SELECT",{name:!0,id:!0});var d=E(n);for(let k=0;k<u.length;k+=1)u[k].l(d);d.forEach(m),c.forEach(m),t=N(a),o&&o.l(a),f=j(),this.h()},h(){D(s,"for","decks"),D(n,"name","decks"),D(n,"id","decks"),i[1]===void 0&&_e(()=>i[6].call(n))},m(a,c){g(a,e,c),A(e,s),A(e,r),A(e,n);for(let d=0;d<u.length;d+=1)u[d]&&u[d].m(n,null);W(n,i[1],!0),g(a,t,c),o&&o.m(a,c),g(a,f,c),_=!0,v||(p=[Z(n,"change",i[6]),Z(n,"change",i[7])],v=!0)},p(a,c){if(c&1){h=Q(a[0]);let d;for(d=0;d<h.length;d+=1){const k=te(a,h,d);u[d]?u[d].p(k,c):(u[d]=ne(k),u[d].c(),u[d].m(n,null))}for(;d<u.length;d+=1)u[d].d(1);u.length=h.length}c&3&&W(n,a[1]),a[2]?o?(o.p(a,c),c&4&&y(o,1)):(o=re(a),o.c(),y(o,1),o.m(f.parentNode,f)):o&&(P(),S(o,1,1,()=>{o=null}),R())},i(a){_||(y(o),_=!0)},o(a){S(o),_=!1},d(a){a&&(m(e),m(t),m(f)),he(u,a),o&&o.d(a),v=!1,pe(p)}}}function ne(i){let e,s=i[10].name+"",l,r;return{c(){e=C("option"),l=T(s),this.h()},l(n){e=b(n,"OPTION",{});var t=E(e);l=H(t,s),t.forEach(m),this.h()},h(){e.__value=r=i[10],G(e,e.__value)},m(n,t){g(n,e,t),A(e,l)},p(n,t){t&1&&s!==(s=n[10].name+"")&&O(l,s),t&1&&r!==(r=n[10])&&(e.__value=r,G(e,e.__value))},d(n){n&&m(e)}}}function re(i){let e,s,l;function r(t){i[8](t)}let n={};return i[1]!==void 0&&(n.selectedDeck=i[1]),e=new Ae({props:n}),ae.push(()=>ge(e,"selectedDeck",r)),e.$on("srs",i[9]),{c(){q(e.$$.fragment)},l(t){z(e.$$.fragment,t)},m(t,f){F(e,t,f),l=!0},p(t,f){const _={};!s&&f&2&&(s=!0,_.selectedDeck=t[1],me(()=>s=!1)),e.$set(_)},i(t){l||(y(e.$$.fragment,t),l=!0)},o(t){S(e.$$.fragment,t),l=!1},d(t){K(e,t)}}}function Se(i){let e,s,l,r,n=i[4]&&se(),t=(i[3]||i[2])&&le(i);return{c(){e=C("div"),s=C("div"),n&&n.c(),l=V(),t&&t.c(),this.h()},l(f){e=b(f,"DIV",{class:!0});var _=E(e);s=b(_,"DIV",{class:!0});var v=E(s);n&&n.l(v),l=N(v),t&&t.l(v),v.forEach(m),_.forEach(m),this.h()},h(){D(s,"class","container svelte-1m9hyv3"),D(e,"class","page")},m(f,_){g(f,e,_),A(e,s),n&&n.m(s,null),A(s,l),t&&t.m(s,null),r=!0},p(f,[_]){f[4]?n||(n=se(),n.c(),n.m(s,l)):n&&(n.d(1),n=null),f[3]||f[2]?t?(t.p(f,_),_&12&&y(t,1)):(t=le(f),t.c(),y(t,1),t.m(s,null)):t&&(P(),S(t,1,1,()=>{t=null}),R())},i(f){r||(y(t),r=!0)},o(f){S(t),r=!1},d(f){f&&m(e),n&&n.d(),t&&t.d()}}}function Ve(i,e,s){let l,r,n,t=[],f;const _=(o,a)=>{const c=f,d=o,k=t.findIndex(M=>M===c),I=c.sentences.findIndex(M=>M===d);console.log(k,I),k!==-1&&I!==-1&&console.log(c.sentences[I]),k!==-1&&I!==-1&&(c.sentences[I]={...d,srs:a},s(0,t[k]=c,t)),localStorage.setItem("decks",JSON.stringify(t))};oe(()=>{const o=localStorage.getItem("decks");o&&s(0,t=JSON.parse(o))});function v(){f=ve(this),s(1,f),s(0,t)}const p=()=>console.log(f);function h(o){f=o,s(1,f)}const u=o=>{_(o.detail.sentence,o.detail.srs)};return i.$$.update=()=>{i.$$.dirty&1&&s(4,l=t.length===0),i.$$.dirty&1&&s(3,r=t.length>0),i.$$.dirty&2&&s(2,n=f!==null)},[t,f,n,r,l,_,v,p,h,u]}class Te extends ce{constructor(e){super(),fe(this,e,Ve,Se,ie,{})}}export{Te as component};
